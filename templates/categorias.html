{% extends 'base.html' %}
{% block title %}Categorias e Tags - FinanÃ§asPro{% endblock %}

{% block content %}
<section class="page-section">
    <div class="page-header">
        <div>
            <h1><i class="fas fa-tags"></i> Categorias e Tags</h1>
            <p class="page-subtitle">Organize suas transaÃ§Ãµes com categorias e tags</p>
        </div>
        <div class="page-actions">
            <button class="btn btn-primary" onclick="openModal('addCatModal')">
                <i class="fas fa-plus"></i> Nova Categoria
            </button>
            <button class="btn btn-glass" onclick="openModal('addTagModal')">
                <i class="fas fa-plus"></i> Nova Tag
            </button>
        </div>
    </div>

    <!-- Categorias de Receita -->
    <div class="section-card">
        <div class="section-card-header">
            <h2><i class="fas fa-arrow-up" style="color: var(--accent-green)"></i> Categorias de Receita</h2>
        </div>
        <div class="items-grid">
            {% for cat in categorias if cat.tipo == 'receita' %}
            <div class="item-chip">
                <i class="fas {{ cat.icone }}" style="color: {{ cat.cor }}"></i>
                <span>{{ cat.nome }}</span>
                <form action="{{ url_for('excluir_categoria', id=cat.id) }}" method="POST" class="inline-form"
                    onsubmit="return confirm('Excluir categoria {{ cat.nome }}?')">
                    <button type="submit" class="chip-delete"><i class="fas fa-times"></i></button>
                </form>
            </div>
            {% else %}
            <p class="text-muted">Nenhuma categoria de receita</p>
            {% endfor %}
        </div>
    </div>

    <!-- Categorias de Despesa -->
    <div class="section-card">
        <div class="section-card-header">
            <h2><i class="fas fa-arrow-down" style="color: var(--accent-red)"></i> Categorias de Despesa</h2>
        </div>
        <div class="items-grid">
            {% for cat in categorias if cat.tipo == 'despesa' %}
            <div class="item-chip">
                <i class="fas {{ cat.icone }}" style="color: {{ cat.cor }}"></i>
                <span>{{ cat.nome }}</span>
                <form action="{{ url_for('excluir_categoria', id=cat.id) }}" method="POST" class="inline-form"
                    onsubmit="return confirm('Excluir categoria {{ cat.nome }}?')">
                    <button type="submit" class="chip-delete"><i class="fas fa-times"></i></button>
                </form>
            </div>
            {% else %}
            <p class="text-muted">Nenhuma categoria de despesa</p>
            {% endfor %}
        </div>
    </div>

    <!-- Tags -->
    <div class="section-card">
        <div class="section-card-header">
            <h2><i class="fas fa-hashtag" style="color: var(--accent-blue)"></i> Tags</h2>
        </div>
        <div class="items-grid">
            {% set user_tags = [] %}
            {% for cat in categorias %}{% endfor %}
            {% for tag in current_user.tags %}
            <div class="item-chip" style="border-color: {{ tag.cor }}40">
                <span class="tag-dot" style="background: {{ tag.cor }}"></span>
                <span>{{ tag.nome }}</span>
                <form action="{{ url_for('excluir_tag', id=tag.id) }}" method="POST" class="inline-form"
                    onsubmit="return confirm('Excluir tag {{ tag.nome }}?')">
                    <button type="submit" class="chip-delete"><i class="fas fa-times"></i></button>
                </form>
            </div>
            {% else %}
            <p class="text-muted">Nenhuma tag criada. Tags ajudam a filtrar transaÃ§Ãµes.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Modal: Nova Categoria -->
<div class="modal-overlay" id="addCatModal">
    <div class="modal">
        <div class="modal-header">
            <h2><i class="fas fa-tag"></i> Nova Categoria</h2>
            <button class="modal-close" onclick="closeModal('addCatModal')"><i class="fas fa-times"></i></button>
        </div>
        <form action="{{ url_for('nova_categoria') }}" method="POST" class="modal-form">
            <div class="form-group">
                <label>Nome</label>
                <input type="text" name="nome" placeholder="Ex: AlimentaÃ§Ã£o, SalÃ¡rio..." required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Tipo</label>
                    <select name="tipo" required>
                        <option value="despesa">Despesa</option>
                        <option value="receita">Receita</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cor</label>
                    <input type="color" name="cor" value="#7c5cfc" class="color-input">
                </div>
            </div>
            <div class="form-group">
                <label>Ãcone</label>
                <select name="icone">
                    <option value="fa-tag">ğŸ·ï¸ Tag</option>
                    <option value="fa-utensils">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                    <option value="fa-car">ğŸš— Transporte</option>
                    <option value="fa-house">ğŸ  Moradia</option>
                    <option value="fa-heart-pulse">ğŸ’Š SaÃºde</option>
                    <option value="fa-graduation-cap">ğŸ“ EducaÃ§Ã£o</option>
                    <option value="fa-gamepad">ğŸ® Lazer</option>
                    <option value="fa-shirt">ğŸ‘• Roupas</option>
                    <option value="fa-money-bill-wave">ğŸ’° SalÃ¡rio</option>
                    <option value="fa-laptop-code">ğŸ’» Freelance</option>
                    <option value="fa-chart-line">ğŸ“ˆ Investimento</option>
                    <option value="fa-file-invoice">ğŸ“„ Contas</option>
                    <option value="fa-tv">ğŸ“º Streaming</option>
                    <option value="fa-gift">ğŸ Presente</option>
                    <option value="fa-plane">âœˆï¸ Viagem</option>
                    <option value="fa-paw">ğŸ¾ Pets</option>
                    <option value="fa-receipt">ğŸ§¾ Outros</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-check"></i> Criar Categoria
            </button>
        </form>
    </div>
</div>

<!-- Modal: Nova Tag -->
<div class="modal-overlay" id="addTagModal">
    <div class="modal">
        <div class="modal-header">
            <h2><i class="fas fa-hashtag"></i> Nova Tag</h2>
            <button class="modal-close" onclick="closeModal('addTagModal')"><i class="fas fa-times"></i></button>
        </div>
        <form action="{{ url_for('nova_tag') }}" method="POST" class="modal-form">
            <div class="form-row">
                <div class="form-group">
                    <label>Nome da Tag</label>
                    <input type="text" name="nome" placeholder="Ex: viagem-sp, emergÃªncia..." required>
                </div>
                <div class="form-group">
                    <label>Cor</label>
                    <input type="color" name="cor" value="#45b7d1" class="color-input">
                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-block">
                <i class="fas fa-check"></i> Criar Tag
            </button>
        </form>
    </div>
</div>
{% endblock %}